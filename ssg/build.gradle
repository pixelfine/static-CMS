plugins {
    id 'eclipse'
    id 'java'
    id 'application'
    id 'jacoco'
}

mainClassName = 'Main'

group 'org.example'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    compile "org.commonmark:commonmark:0.17.0"
    compile 'org.tomlj:tomlj:1.0.0'
    compile "com.google.guava:guava:30.1-jre"
    compile "com.hubspot.jinjava:jinjava:2.5.7"
    compile "info.bliki.wiki:bliki-core:3.0.19"
    testImplementation(platform('org.junit:junit-bom:5.7.0'))
    testImplementation 'org.junit.jupiter:junit-jupiter'
    implementation group: 'nu.validator', name: 'validator', version: '20.7.2'
}

apply plugin: 'jacoco'

tasks.named('test') {
    useJUnitPlatform()
    finalizedBy jacocoTestReport
    finalizedBy jacocoTestCoverageVerification
}

jacocoTestReport {
    dependsOn check
    sourceDirectories.from files(sourceSets.main.allJava.srcDirs)
    reports {
        csv.enabled true
        csv.destination file("${buildDir}/jacocoCsv")
    }
}

jar {
    manifest {
        attributes(
                'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
                'Main-Class': 'Main'
        )
    }
}
